FROM registry.redhat.io/ubi8/go-toolset:latest as builder

WORKDIR /go/src/app
COPY . .

USER 0

RUN go get -d ./... && \
    go build -o platform-changelog-api cmd/platform-changelog-api/main.go

RUN cp /go/src/app/platform-changelog-api /usr/bin

FROM registry.redhat.io/ubi8/ubi8-minimal:latest

WORKDIR /

COPY --from=builder /go/src/app/platform-changelog-api ./platform-changelog-api

USER 1001

CMD ["/platform-changelog-api"]
